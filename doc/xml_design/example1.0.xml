<?xml version="1.0" encoding="utf-8"?>
<?xml-model href="example1.0.xsd"?>
<RuleSet version="1.0">
    <TypeDefines>
        <TypeDefine type="Location">
            <Variable name="altitude" type="float64" />
            <Variable name="longitude" type="float64" />
            <Variable name="latitude" type="float64" />
        </TypeDefine>
        <TypeDefine type="Vector3">
            <Variable name="x" type="float64" />
            <Variable name="y" type="float64" />
            <Variable name="z" type="float64" />
        </TypeDefine>
    </TypeDefines>
    <MetaInfo>
        <Inputs>
            <!-- init value not fully supported -->
            <Param name="Input1" type="float64[]" />
            <Param name="Input2" type="float64" />
        </Inputs>
        <Outputs>
            <Param name="Output1" type="float64" />
        </Outputs>
        <Caches>
            <Param name="Cache1" type="float64">
                <Value><Expression>Input1[0]+Input2</Expression></Value>
            </Param>
            <Param name="Cache2" type="float64[]" />
            <Param name="Cache3" type="float64[]" />
            <Param name="Cache4" type="float64[]" />
        </Caches>
    </MetaInfo>
    <SubRuleSets>
        <SubRuleSet>
            <Rules>
                <Rule>
                    <Condition>
                        <Expression>Cache2.length()==0</Expression>
                    </Condition>
                    <Consequence>
                        <Assignment>
                            <Target>Cache2</Target>
                            <Value>
                                <Expression>Input1</Expression>
                            </Value>
                        </Assignment>
                        <Assignment>
                            <Target>Cache3</Target>
                            <Value>
                                <Expression>
                                []f64{
                                    trimf(0.1, 0.5, 1, 2),
                                    trimf(0.3, 0.5, 1, 2),
                                    trimf(0.6, 0.5, 1, 2),
                                    trimf(0.8, 0.5, 1, 2),
                                    trimf(1.3, 0.5, 1, 2),
                                    trimf(2, 0.5, 1, 2)
                                }
                                </Expression>
                            </Value>
                        </Assignment>
                        <Assignment>
                            <Target>Cache4</Target>
                            <Value>
                                <Expression>
                                []f64{
                                    trapmf(0.1, 0.5, 1, 2, 2.1),
                                    trapmf(0.3, 0.5, 1, 2, 2.1),
                                    trapmf(0.6, 0.5, 1, 2, 2.1),
                                    trapmf(0.8, 0.5, 1, 2, 2.1),
                                    trapmf(1.3, 0.5, 1, 2, 2.1),
                                    trapmf(2, 0.5, 1, 2, 2.1),
                                    trapmf(2.05, 0.5, 1, 2, 2.1),
                                    trapmf(2.1, 0.5, 1, 2, 2.1),
                                }
                                </Expression>
                            </Value>
                        </Assignment>
                    </Consequence>
                </Rule>
            </Rules>
        </SubRuleSet>
        <SubRuleSet>
            <Rules>
                <Rule>
                    <Condition>
                        <Expression>Cache2.length()!=0</Expression>
                    </Condition>
                    <Consequence>
                        <Assignment>
                            <Target>Output1</Target>
                            <Value>
                                <Expression>Cache2[Cache2.length()-1]</Expression>
                            </Value>
                        </Assignment>
                        <ArrayOperation>
                            <Target>Cache2</Target>
                            <Operation>push</Operation>
                            <Args>
                                <Expression>Cache2.length()</Expression>
                            </Args>
                        </ArrayOperation>
                    </Consequence>
                </Rule>
            </Rules>
        </SubRuleSet>
    </SubRuleSets>
</RuleSet>